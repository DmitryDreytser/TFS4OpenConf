
------   repository_cvt.pl  -------

Скрипт repository_cvt.pl предназначен для конвертации CVS-репозитариев,
созданных ранними версиями gcomp.
Скрипт написан на Perl'е, подробнее см. описание к correct_dlg.

Принцип конвертации:
 - Создаётся новый репозитарий, где будет сложена сконвертированная версия.
Старый репозитарий остаётся в исходном состоянии.
 - В старом репозитарии анализируется полный лог всех файлов репозитария,
выделяются отдельные коммиты.
 - Для каждого исходного коммита берём изменённые файлы из исходного репозитария;
из рабочего каталога соответствующей версией gcomp собираем МДшник; разбираем
полученный МДшник новой версией gcomp и коммитим в новый репозитарий.

Пока что конвертируется только основной ствол репозитария. Все ветки просто отбрасываются.
Исходные дата и имя пользователя сохраняются в комментарии.


Способ определения версии gcomp:
Просто пытаемся собрать рабочий каталог всеми версиями, начиная с младшей.
Как только удалось собрать - значит это и есть нужная нам версия, и все
предыдущие версии из очереди удаляются.
Единственный недостаток такого метода в том, что иногда gcomp валится с ошибкой,
и выдаёт модальное окно с сообщением - работа скрипта при этом приостанавливается.
Как только в исходной рабочей копии появляется файл gcomp.ver, то версия берётс
непосредственно из него.


Настройка скрипта:
Все настройки делаются в тексте самого скрипта. Нужно заполнить следующие переменные
   $SaveDateTime - если 1, то скрипт попытается сохранить дату и время коммита.
      Для этого перед коммитом в новый репозитарий просто меняется системная дата. Если
      репозитарий находится не на текущей машине, то эффекта от этого не будет.
      Чтобы не сохранять дату и время коммитов надо установить $SaveDateTime в 0 - в этом
      случае дата и время будут записаны в комментарии.
   $auto_add_script - полный путь к скрипту auto_ad.pl
   $repostory_new_dir - полный путь к каталогу с новым репозитарием.
      Нужен только для того, чтобы автоматически удалить этот каталог перед началом конвертации.
      Если не заполнять, то ничего удаляться не будет.
   $top_dir - основной каталог работы скрипта. В нём будут создаваться временные файлы,
      и рабочие каталоги старого и нового репозитариев. Путь должен быть абсолютным.
   $working_dir - имя рабочего каталога для старого репозитария. Имя не должно содержать '\'
   $new_working_dir имя рабочего каталога для нового репозитария. Имя не должно содержать '\'
   $module - имя модуля старого репозитари
   $new_module - имя модуля нового репозитари
   @gcomp_versions - очередь версий gcomp
   $ENV{"CVSROOT"} - если у вас не задана переменая среды CVSROOT, или для конвертации вы
      используете другое её значение, то необходимо записать сюда нужное значение. Само
      значение можно посмотреть в WinCvs, настроив его на нужный репозитарий.

Для работы скрипта необходимо наличие всех версий gcomp, которые указаны в @gcomp_versions.
Имя файла образуется как 'gcomp' + <номер версии> + 'exe'

=====================================================================================================


------   1c_vss2cvs.pl  -------
Скрипт 1c_vss2cvs.pl предназначен для конвертации VSS-репозитариев в CVS, в случаях
когда в VSS хранится целиком 1cv7.md.


Настройка скрипта:
   $SaveDateTime, $auto_add_script и $ENV{"CVSROOT"} - как в repository_cvt.pl

Запуск:
perl 1c_vss2cvs.pl <VSS project name> <CVS module name> [StartVersion [StopVersion]]
  - VSS project name - полный путь к файлу 1cv7.md в VSS. Например $/Бухгалтерия филиалов/current/1cv7.md
  - CVS module name - имя модуля в CVS
  - StartVersion - если задан, то версии из VSS будут браться начиная с указанной.
    Если конвертация начинается с первой версии, то автоматически создаётся новый модуль в CVS. Модуля с
    указанным именем не должно быть в CVS-репозитарии. Если конвертация начинается не с первой версии, то
    изменения добавляются в существующий модуль.
  - StopVersion - если задан, то конвертироваться будут версии из VSS до указанной. Если не задан,
    то будут сконвертированы все версии.

Все временные файлы и рабочий каталог создаются в текущем каталоге.

=====================================================================================================


Автор - Диркс Алексей mailto:adirks@ngs.ru